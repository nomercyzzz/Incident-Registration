<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Система регистрации инцидентов</title>
    <link rel="stylesheet" href="../styles/index.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body>
    <div id="app" class="page-wrapper">
        <header class="header">
            <div class="header-left">
                <div class="logo-wrapper">
                    <svg class="shield-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path class="shield-path" d="M12 22C12 22 20 18 20 12V5L12 2L4 5V12C4 18 12 22 12 22Z" stroke="currentColor" stroke-width="1.5"/>
                        <path class="checkmark-path" d="M9 12L11 14L15 10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
                <h1 class="page-title">Система регистрации происшествий</h1>
            </div>
            <div class="header-actions">
                <div v-if="isAuthenticated" class="user-menu">
                    <button @click="toggleUserMenu" class="user-icon-btn">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M12 2a3 3 0 100 6 3 3 0 000-6zM8 8a4 4 0 118 0 4 4 0 01-8 0zm-2 9a2 2 0 012-2h8a2 2 0 012 2v1H6v-1z"/>
                        </svg>
                    </button>                    <div v-if="showUserMenu" class="user-dropdown">
                        <div class="user-info">{{ userLogin }}</div>
                        <a href="account.html" class="dropdown-item">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M12 15C15.3137 15 18 12.3137 18 9C18 5.68629 15.3137 3 12 3C8.68629 3 6 5.68629 6 9C6 12.3137 8.68629 15 12 15Z"/>
                                <path d="M2.90625 20.2491C3.82834 18.6531 5.15342 17.3278 6.74958 16.4055C8.34574 15.4831 10.1568 15 12 15C13.8432 15 15.6543 15.4831 17.2504 16.4055C18.8466 17.3278 20.1717 18.6531 21.0938 20.2491"/>
                            </svg>
                            Аккаунт
                        </a>
                        <button @click="logout" class="dropdown-item">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M9 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H9"/>
                                <path d="M16 17L21 12L16 7"/>
                                <path d="M21 12H9"/>
                            </svg>
                            Выйти
                        </button>
                    </div>
                </div>
                <a v-else href="account.html" class="account-btn">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M10 2a3 3 0 100 6 3 3 0 000-6zM8 8a4 4 0 118 0 4 4 0 01-8 0zm-2 9a2 2 0 012-2h8a2 2 0 012 2v1H6v-1z" stroke="currentColor"/>
                    </svg>
                    <span>Войти</span>
                </a>
                <button class="add-btn" @click="navigateToAddIncident">
                    <span>Добавить инцидент</span>
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M10 4V16M4 10H16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
        </header>
        <div class="statistics">
            <div class="stat-card">
                <h3>Всего инцидентов</h3>
                <div class="stat-number">{{ totalIncidents }}</div>
            </div>
            <div class="stat-card">
                <div class="stat-header">
                    <h3>За период</h3>
                    <select v-model="selectedPeriod" class="period-select">
                        <option value="7">За 7 дней</option>
                        <option value="30">За 30 дней</option>
                        <option value="90">За 90 дней</option>
                        <option value="365">За год</option>
                    </select>
                </div>
                <div class="stat-number">{{ currentPeriodIncidents }}</div>
            </div>
        </div>
        <div class="filters-section">
            <div class="filters-title">
                <h2>Фильтры поиска</h2>
            </div>
            <div class="filters-grid">
                <div class="filter-block">
                    <label>Поиск</label>
                    <div class="search-field">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <path d="M9 17A8 8 0 109 1A8 8 0 009 17ZM19 19L13 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <input type="text" v-model="searchQuery" placeholder="Поиск по номеру или типу...">
                    </div>
                </div>
                <div class="filter-block">
                    <label>Тип происшествия</label>
                    <div class="select-field">
                        <select v-model="typeFilter">
                            <option value="">Все типы</option>
                            <option v-for="type in incidentTypes" :value="type">{{ type }}</option>
                        </select>
                    </div>
                </div>
                <div class="filter-block">
                    <label>Статус</label>
                    <div class="select-field">
                        <select v-model="statusFilter">
                            <option value="">Все статусы</option>
                            <option v-for="status in statuses" :value="status">{{ status }}</option>
                        </select>
                    </div>
                </div>
                <div class="filter-block">
                    <label>Дата</label>
                    <div class="date-field">
                        <input type="date" v-model="dateFilter">
                    </div>
                </div>
            </div>
        </div>
        <div class="table-container">
            <table class="incidents-table">
                <thead>
                    <tr>
                        <th>Номер</th>
                        <th>Дата</th>
                        <th>Тип</th>
                        <th>Место</th>
                        <th>Статус</th>
                        <th>Действия</th>
                    </tr>
                </thead>
                <tbody>                    <tr v-for="incident in incidents" :key="incident.regNumber">
                        <td>{{ incident.regNumber }}</td>
                        <td>{{ formatDate(incident.date) }}</td>
                        <td>{{ incident.type }}</td>
                        <td>{{ incident.location }}</td>
                        <td>
                            <span :class="['status-badge', 
                                incident.status === 'Удовлетворено' ? 'approved' : 
                                incident.status === 'Отказано' ? 'rejected' : 
                                'pending']">
                                {{ incident.status }}
                            </span>
                        </td>
                        <td>
                            <button @click="showDetails(incident)" class="details-btn">
                                Подробнее
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="pagination">
            <button class="page-btn" 
                    :disabled="currentPage === 1"
                    @click="currentPage--">
                Назад
            </button>
            <span>Страница {{ currentPage }} из {{ totalPages }}</span>
            <button class="page-btn"
                    :disabled="currentPage === totalPages"
                    @click="currentPage++">
                Вперед
            </button>
        </div>
        <div v-if="selectedIncident" class="modal-backdrop" @click="closeDetails">
            <div class="modal-content" @click.stop>
                <h2>Детали инцидента #{{ selectedIncident.regNumber }}</h2>
                <div class="incident-details">
                    <div class="incident-main-info">
                        <p><strong>Дата:</strong> {{ formatDate(selectedIncident.date) }}</p>
                        <p><strong>Тип:</strong> {{ selectedIncident.type }}</p>
                        <p><strong>Место:</strong> {{ selectedIncident.location }}</p>
                        <p><strong>Статус:</strong> {{ selectedIncident.status }}</p>
                        <p><strong>Описание:</strong> {{ selectedIncident.description }}</p>
                    </div>
                    
                    <div class="involved-persons" v-if="selectedIncident.involvedPersons && selectedIncident.involvedPersons.length">
                        <h3>Причастные лица:</h3>
                        <div class="person-cards">
                            <div v-for="person in selectedIncident.involvedPersons" 
                                :key="person.regNumber" 
                                :class="['person-card', person.role.toLowerCase()]">
                                <div class="person-header">
                                    <div class="person-header-role">
                                        <span class="person-role">{{ person.role }}</span>
                                        <span class="person-id">№{{ person.regNumber }}</span>
                                    </div>
                                    <div class="criminal-record" v-if="person.criminalRecord > 0">
                                        Судимостей: {{ person.criminalRecord }}
                                    </div>
                                </div>
                                <div class="person-info">
                                    <p><strong>ФИО:</strong> {{ person.fullName }}</p>
                                    <p><strong>Адрес:</strong> {{ person.address }}</p>
                                    <p v-if="person.details"><strong>Примечание:</strong> {{ person.details }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="add-btn" @click="closeDetails">Закрыть</button>
                </div>
            </div>
        </div>
    </div>
    <script src="../script/index.js"></script>
</body>
</html>