# Incident registration

Система регистрации и управления инцидентами с веб-интерфейсом.

## Описание

Incident registration - это комплексное решение для регистрации, отслеживания и управления различными типами инцидентов. Система предоставляет удобный веб-интерфейс для пользователей и администраторов, позволяя эффективно управлять информацией об происшествиях.

### Уровни доступа

Система имеет три уровня доступа:

1. **Гость (неавторизованный пользователь)**
   - Просмотр общей информации
   - Возможность регистрации и входа в систему

2. **Зарегистрированный пользователь**
   - Создание и просмотр инцидентов
   - Управление своим профилем
   - Отслеживание статуса своих инцидентов

3. **Администратор**
   - Полный доступ к системе
   - Управление пользователями
   - Управление всеми инцидентами
   - Доступ к статистике и аналитике
   - Модерация контента

## Основные возможности

- Регистрация и авторизация пользователей
- Добавление и редактирование инцидентов
- Классификация инцидентов по типам
- Отслеживание статуса инцидентов
- Управление причастными лицами
- Административная панель для управления пользователями и инцидентами
- Фильтрация и поиск по инцидентам
- Статистика происшествий

## Технологии

### Frontend
- Vue.js 3 (через CDN)
- HTML5
- CSS3
- Tailwind CSS

### Backend
- Node.js
- Express.js
- MySQL
- JSON Web Tokens (JWT)
- bcryptjs

### Зависимости backend
- express: веб-фреймворк
- mysql2: драйвер для MySQL
- bcryptjs: хеширование паролей
- jsonwebtoken: работа с JWT
- dotenv: управление переменными окружения
## Установка и запуск

1. Клонируйте репозиторий:
```bash
git clone https://github.com/nomercyzzz/Incident-Registration.git
cd "Incident registration"
```

2. Установите зависимости:
```bash
# Установка зависимостей backend
cd backend
npm install

# Установка зависимостей frontend
cd ../frontend
npm install
```

3. Настройте базу данных MySQL:

- Установите MySQL, если еще не установлен
- Создайте файл `.env` в папке `backend` со следующими параметрами:
```
# Настройки базы данных
DB_HOST=localhost
DB_USER=your_username
DB_PASS=your_password
DB_NAME=incident_db

# Настройки JWT
JWT_SECRET=your_secret_key
JWT_EXPIRES=24h

# Настройки сервера (опционально)
PORT=3000
```

- Создайте базу данных и таблицы. Есть два способа:

  Способ 1 (через командную строку):
  ```bash
  # Создание таблиц
  mysql -u your_username -p < backend/create_tables.sql
  ```

  Способ 2 (через MySQL Workbench):
  - Откройте MySQL Workbench
  - Подключитесь к вашему серверу MySQL
  - Откройте файл `backend/create_tables.sql`
  - Нажмите кнопку "Execute" (или F5) для выполнения скрипта

- Импортируйте начальные данные:
  ```bash
  # Перейдите в папку backend
  cd backend
  
  # Установите зависимости, если еще не установлены
  npm install
  
  # Запустите скрипт миграции
  node migrate_incidents_forms.js
  ```

Скрипт миграции импортирует данные из `data/incidents.json` и `data/forms.json` в созданные таблицы MySQL.

4. Запустите сервер:
```bash
cd backend
npm start
```

После запуска сервера приложение будет доступно по адресу `http://localhost:3000` (или другому порту, указанному в конфигурации).

## Структура проекта

```
backend/
  ├── data/         # JSON файлы с данными
  ├── logic/        # Бизнес-логика
  └── server.js     # Основной файл сервера

frontend/
  └── src/
      ├── script/   # JavaScript файлы
      ├── styles/   # CSS стили
      └── view/     # HTML шаблоны
```

## API Endpoints

### Аутентификация
- POST /api/register - Регистрация пользователя
- POST /api/login - Авторизация пользователя

### Инциденты
- GET /api/incidents - Получение списка инцидентов
- POST /api/incidents - Создание нового инцидента
- PUT /api/incidents/:id - Обновление инцидента
- DELETE /api/incidents/:id - Удаление инцидента

## Безопасность и роли пользователей

### Управление пользователями и ролями

#### Начальная настройка
Система поставляется со стандартной учетной записью администратора:
```
Логин: admin
Пароль: padmin
```
После первого входа рекомендуется сменить пароль администратора.

#### Регистрация новых пользователей
1. **Создание таблиц**
   - При первом запуске автоматически создается таблица `users`
   - Таблица содержит поля: id, username, password, role

2. **Процесс регистрации**
   - Пользователь заполняет форму регистрации
   - Система автоматически хеширует пароль
   - Новому пользователю присваивается роль 'user'
   - Данные сохраняются в таблицу MySQL

3. **Роли пользователей**
   - 'admin' - полный доступ к системе
   - 'user' - ограниченный доступ

### Механизмы безопасности

- Хеширование паролей: все пароли хешируются с использованием bcrypt
- JWT токены: используются для аутентификации пользователей
- CORS: защита API от несанкционированных запросов
- Валидация данных: проверка всех входящих данных
- Ограничение доступа: проверка прав доступа для каждого запроса
